<!DOCTYPE html>
<html lang="en">

<head>
      <!-- Global site tag (gtag.js) - Google Analytics -->
  <!-- Custom Theme JavaScript -->
    <script async defer src="https://buttons.github.io/buttons.js"></script>
   <a href="https://github.com/channelCS/channelcs.github.io"><img style="position: absolute; top: 0; Right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png" alt="Star me on GitHub"></a>
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-112480279-1"></script>
  <script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-112480279-1');
  </script>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="description" content="">
        <meta name="author" content="">

        <title>channelCS Blog</title>

            <link href="/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="channelCS Blog Full Atom Feed" />
            <link href="/feeds/audio-processing.atom.xml" type="application/atom+xml" rel="alternate" title="channelCS Blog Categories Atom Feed" />

        <!-- Bootstrap Core CSS -->
        <link href="/theme/css/bootstrap.min.css" rel="stylesheet">

        <!-- Custom CSS -->
        <link href="/theme/css/clean-blog.min.css" rel="stylesheet">

        <!-- Code highlight color scheme -->
            <link href="/theme/css/code_blocks/darkly.css" rel="stylesheet">

        <!-- Custom Fonts -->
        <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">
        <link href='//fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
        <link href='//fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/css'>

        <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
        <![endif]-->




        <meta name="tags" contents="DNN" />
        <meta name="tags" contents="Audio" />


			<meta property="og:locale" content="en">
		<meta property="og:site_name" content="channelCS Blog">

	<meta property="og:type" content="article">
	<meta property="article:author" content="">
	<meta property="og:url" content="/build-our-first-neural-network-for-audio-processing.html">
	<meta property="og:title" content="Build our first Neural Network for Audio Processing">
	<meta property="og:description" content="">
	<meta property="og:image" content="/">
	<meta property="article:published_time" content="2016-01-15 00:00:00+05:30">
</head>

<body>

    <!-- Navigation -->
    <nav class="navbar navbar-default navbar-custom navbar-fixed-top">
        <div class="container-fluid">
            <!-- Brand and toggle get grouped for better mobile display -->
            <div class="navbar-header page-scroll">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="/">channelCS Blog</a>
            </div>

            <!-- Collect the nav links, forms, and other content for toggling -->
            <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                <ul class="nav navbar-nav navbar-right">

                </ul>
            </div>
            <!-- /.navbar-collapse -->
        </div>
        <!-- /.container -->
    </nav>

    <!-- Page Header -->
        <header class="intro-header" style="background-image: url('/theme/images/post-bg.jpg')">
        <div class="container">
            <div class="row">
                <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                    <div class="post-heading">
                        <h1>Build our first Neural Network for Audio Processing</h1>
                        <span class="meta">Posted by
                                <a href="/author/aditya-arora.html">Aditya Arora</a>
                                <a href="/author/akshita-gupta.html">Akshita Gupta</a>
                             on Fri 15 January 2016
                        </span>
                        
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
    <!-- Post Content -->
    <article>
        <p>Prerequisites:
* Up and Running with Keras</p>
<ul>
<li>Implementing DNN using Keras</li>
</ul>
<p><strong>What is different in Audio?</strong></p>
<p>A standard deep learning model passes the arrays of text or images directly to the Deep Neural Network or Convolution Neural Network and the rest is done by the model itself.</p>
<p>As far as Audio is concerned, we first extract features which are then passed to the model for training.</p>
<p>In this tutorial, you will discover how to develop a multichannel convolutional neural network for Acoustic Scene Classification the NAR dataset.</p>
<h2>1. Understanding the Dataset</h2>
<p>We shall be using the NAR dataset which can be downloaded from this <a href="https://team.inria.fr/perception/nard/">Link</a> to the dataset. The data are freely accessible for scientific research purposes and for non-commercial applications.</p>
<p>NAR is a dataset  of audio recordings made with the humanoid robot Nao in real-world conditions for sound recognition benchmarking.</p>
<h3>1.a. Audio Characteristics</h3>
<p>There are certain parameters in audio which must be considered. These tell us about how and under what conditions were the recordings made for the dataset. The audio for the NAR Dataset has the following characteristics
* recorded with low-quality sensors (300 Hz – 18 kHz bandpass)</p>
<ul>
<li>
<p>suffering from typical fan noise from the robot’s internal hardware</p>
</li>
<li>
<p>recorded in multiple real domestic environments (no special acoustic characteristics, reverberations, the presence of multiple sound sources and unknown locations)</p>
</li>
</ul>
<h3>1.b. Dataset Characteristics</h3>
<p>Now comes the details of the dataset files. These are important to consider as we have to convert everything in arrays and pass it on to the model.</p>
<p>The dataset is organized as follows:
* Each class is represented by a folder containing all the audio files labeled with the class.</p>
<ul>
<li>
<p>The name of a folder is the name of the class attached. The name of an audio file is “foldername$id.wav” where $id is an incremental identifier starting at 1.</p>
</li>
<li>
<p>Each audio file is provided in a WAV format (mono signal, 48kHz sampling rate and 16 bits per sample).</p>
</li>
<li>
<p>42 different class for 852 sounds have been recorded and organized.</p>
</li>
<li>
<p>We shall consider four labels <strong>Kitchen</strong>, <strong>Office</strong>, <strong>Nonverbal</strong>, and <strong>Speech</strong>.</p>
</li>
</ul>
<h2>2. Dataset Manipulation</h2>
<p>After downloading, we are going to extract it in a folder named <code>NAR_dataset</code>. The <code>tree</code> looks something like</p>
<div class="highlight"><pre><span></span>└───NAR_dataset
    ├───alarmfridge
    ├───alarmmicrowave
    ├───...
    ├───zipone
    └───ziptwo
</pre></div>


<p>We are going to make a file so that the directory structure changes to</p>
<table>
<thead>
<tr>
<th>Scenarios</th>
<th>Classes</th>
</tr>
</thead>
<tbody>
<tr>
<td>Kitchen</td>
<td>Eating, Choking, Cuttlery, Fill a glass, Running the tap, Open/close a drawer,Move a chair, Open microwave,Close microwave, Microwave, Fridge, Toaster</td>
</tr>
<tr>
<td>Office</td>
<td>Door Close, Open, Key, Knock, Ripped Paper, Zip, (another) Zip</td>
</tr>
<tr>
<td>Nonverbal</td>
<td>Fingerclap, Handclap, Tongue Clic</td>
</tr>
<tr>
<td>Speech</td>
<td>1,2,3,4,5,6,7,8,9,10, Hello, Left, Right, Turn, Move, Stop, Nao, Yes, No, What</td>
</tr>
</tbody>
</table>
<h3>2.a. Making the config file</h3>
<p>We are now making a config file for feature extraction in which we  place all the details about the dataset. We call it <strong><em>config.py</em></strong>.
There is no such rule of making a config fie as everything can be placed in a single place but that creates a lot of confusion when it comes to sharing codes between multiple developers.</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="k">def</span> <span class="nf">CreateFolder</span><span class="p">(</span> <span class="n">fd</span> <span class="p">):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">fd</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">fd</span><span class="p">)</span>
</pre></div>


<p>The <code>CreateFolder</code> comes in handy while creating multiple folders. It checks whether the folder is already present, if not it creates that folder.</p>
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">shutil</span> <span class="kn">import</span> <span class="n">copytree</span>
<span class="k">def</span> <span class="nf">MoveFolder</span><span class="p">(</span><span class="n">source</span><span class="p">,</span><span class="n">destination</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">copytree</span><span class="p">(</span><span class="n">source</span><span class="p">,</span><span class="n">destination</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Oops! Folder already exists...&quot;</span><span class="p">)</span>
        <span class="k">return</span>
</pre></div>


<p>The <code>MoveFolder</code> function will be used when we want to move certain folders from one diretory to another.</p>
<div class="highlight"><pre><span></span><span class="n">dir_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">realpath</span><span class="p">(</span><span class="vm">__file__</span><span class="p">))</span>
<span class="n">dir_path</span><span class="o">=</span><span class="n">dir_path</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;/&#39;</span><span class="p">)</span>
<span class="n">orig_dataset_path</span><span class="o">=</span><span class="n">dir_path</span><span class="o">+</span><span class="s1">&#39;/NAR_dataset/*&#39;</span>
</pre></div>


<p>We define where does all the audio files reside. In our case, we have put all our files under <code>Nar_dataset</code> directory.</p>
<div class="highlight"><pre><span></span><span class="n">kitchen_array</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;alarmfridge&#39;</span><span class="p">,</span> <span class="s1">&#39;alarmmicrowave&#39;</span><span class="p">,</span> <span class="s1">&#39;chair&#39;</span><span class="p">,</span> <span class="s1">&#39;closemicrowave&#39;</span><span class="p">,</span> <span class="s1">&#39;cuttlery&#39;</span><span class="p">,</span> <span class="s1">&#39;drawer&#39;</span><span class="p">,</span> <span class="s1">&#39;eat&#39;</span><span class="p">,</span> <span class="s1">&#39;openmicrowave&#39;</span><span class="p">,</span> <span class="s1">&#39;strugling&#39;</span><span class="p">,</span> <span class="s1">&#39;tap&#39;</span><span class="p">,</span> <span class="s1">&#39;toaster&#39;</span><span class="p">,</span> <span class="s1">&#39;water&#39;</span><span class="p">]</span>
<span class="n">nonverbal_array</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;fingerclap&#39;</span><span class="p">,</span> <span class="s1">&#39;handclap&#39;</span><span class="p">,</span> <span class="s1">&#39;tongue&#39;</span><span class="p">]</span>
<span class="n">office_array</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;doorclose&#39;</span><span class="p">,</span> <span class="s1">&#39;doorkey&#39;</span><span class="p">,</span> <span class="s1">&#39;doorknock&#39;</span><span class="p">,</span> <span class="s1">&#39;dooropen&#39;</span><span class="p">,</span> <span class="s1">&#39;paper&#39;</span><span class="p">,</span> <span class="s1">&#39;zipone&#39;</span><span class="p">,</span> <span class="s1">&#39;ziptwo&#39;</span><span class="p">]</span>
<span class="n">speech_array</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;eight&#39;</span><span class="p">,</span> <span class="s1">&#39;five&#39;</span><span class="p">,</span> <span class="s1">&#39;four&#39;</span><span class="p">,</span> <span class="s1">&#39;hello&#39;</span><span class="p">,</span> <span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="s1">&#39;move&#39;</span><span class="p">,</span> <span class="s1">&#39;nao&#39;</span><span class="p">,</span> <span class="s1">&#39;nine&#39;</span><span class="p">,</span> <span class="s1">&#39;no&#39;</span><span class="p">,</span> <span class="s1">&#39;one&#39;</span><span class="p">,</span> <span class="s1">&#39;right&#39;</span><span class="p">,</span> <span class="s1">&#39;seven&#39;</span><span class="p">,</span> <span class="s1">&#39;six&#39;</span><span class="p">,</span> <span class="s1">&#39;stop&#39;</span><span class="p">,</span> <span class="s1">&#39;ten&#39;</span><span class="p">,</span> <span class="s1">&#39;three&#39;</span><span class="p">,</span> <span class="s1">&#39;turn&#39;</span><span class="p">,</span> <span class="s1">&#39;two&#39;</span><span class="p">,</span> <span class="s1">&#39;what&#39;</span><span class="p">,</span> <span class="s1">&#39;yes&#39;</span><span class="p">]</span>
</pre></div>


<p>We now define which folder shall be going under which <code>Class Label</code>. This helps in moving the folders in the defined Label.</p>
<div class="highlight"><pre><span></span><span class="n">audio_folder</span><span class="o">=</span><span class="s1">&#39;audios&#39;</span>
<span class="n">kitchen_folder</span>   <span class="o">=</span> <span class="n">audio_folder</span> <span class="o">+</span> <span class="s1">&#39;/Kitchen&#39;</span>
<span class="n">nonverbal_folder</span> <span class="o">=</span> <span class="n">audio_folder</span> <span class="o">+</span> <span class="s1">&#39;/Nonverbal&#39;</span>
<span class="n">office_folder</span>    <span class="o">=</span> <span class="n">audio_folder</span> <span class="o">+</span> <span class="s1">&#39;/Office&#39;</span>
<span class="n">speech_folder</span>    <span class="o">=</span> <span class="n">audio_folder</span> <span class="o">+</span> <span class="s1">&#39;/Speech&#39;</span>
</pre></div>


<p>We now define the folder names for each Class Label. <strong>Remember</strong>, we have not made these folders yet.
the <code>audios</code> is the main folder and all the audio files shall reside in the same folder.</p>
<h3>2.b. Making the file manipulator file</h3>
<p>We are now going to make a file manipulator file the actual moving of files shall take place. We call it <strong><em>file_manipulator.py</em></strong>.</p>
<h4>2.b.i. Moving folders under Class Labels</h4>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">glob</span>
<span class="kn">import</span> <span class="nn">config</span> <span class="kn">as</span> <span class="nn">cfg</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">string</span> <span class="kn">import</span> <span class="n">digits</span>
</pre></div>


<p>The <code>glob</code> function is used to read all files inside a specified folder.
We have also imported out <code>config</code> file here.</p>
<div class="highlight"><pre><span></span><span class="n">path</span><span class="o">=</span><span class="n">cfg</span><span class="o">.</span><span class="n">audio_folder</span>

<span class="n">cfg</span><span class="o">.</span><span class="n">CreateFolder</span><span class="p">(</span><span class="n">cfg</span><span class="o">.</span><span class="n">audio_folder</span><span class="p">)</span>
<span class="n">cfg</span><span class="o">.</span><span class="n">CreateFolder</span><span class="p">(</span><span class="n">cfg</span><span class="o">.</span><span class="n">kitchen_folder</span><span class="p">)</span>
<span class="n">cfg</span><span class="o">.</span><span class="n">CreateFolder</span><span class="p">(</span><span class="n">cfg</span><span class="o">.</span><span class="n">nonverbal_folder</span><span class="p">)</span>
<span class="n">cfg</span><span class="o">.</span><span class="n">CreateFolder</span><span class="p">(</span><span class="n">cfg</span><span class="o">.</span><span class="n">office_folder</span><span class="p">)</span>
<span class="n">cfg</span><span class="o">.</span><span class="n">CreateFolder</span><span class="p">(</span><span class="n">cfg</span><span class="o">.</span><span class="n">speech_folder</span><span class="p">)</span>
</pre></div>


<p>We define the path of our audio files which can directly be taken from the config file.
We are are making folders for our audio and all the class labels.</p>
<div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">cfg</span><span class="o">.</span><span class="n">orig_dataset_path</span><span class="p">):</span>
    <span class="n">g</span><span class="o">=</span><span class="n">f</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">g</span> <span class="ow">in</span> <span class="n">cfg</span><span class="o">.</span><span class="n">kitchen_array</span><span class="p">:</span>
        <span class="n">cfg</span><span class="o">.</span><span class="n">MoveFolder</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">cfg</span><span class="o">.</span><span class="n">kitchen_folder</span><span class="o">+</span><span class="s1">&#39;/&#39;</span><span class="o">+</span><span class="n">g</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">g</span> <span class="ow">in</span> <span class="n">cfg</span><span class="o">.</span><span class="n">nonverbal_array</span><span class="p">:</span>
        <span class="n">cfg</span><span class="o">.</span><span class="n">MoveFolder</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">cfg</span><span class="o">.</span><span class="n">nonverbal_folder</span><span class="o">+</span><span class="s1">&#39;/&#39;</span><span class="o">+</span><span class="n">g</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">g</span> <span class="ow">in</span> <span class="n">cfg</span><span class="o">.</span><span class="n">office_array</span><span class="p">:</span>
        <span class="n">cfg</span><span class="o">.</span><span class="n">MoveFolder</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">cfg</span><span class="o">.</span><span class="n">office_folder</span><span class="o">+</span><span class="s1">&#39;/&#39;</span><span class="o">+</span><span class="n">g</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">g</span> <span class="ow">in</span> <span class="n">cfg</span><span class="o">.</span><span class="n">speech_array</span><span class="p">:</span>
        <span class="n">cfg</span><span class="o">.</span><span class="n">MoveFolder</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">cfg</span><span class="o">.</span><span class="n">speech_folder</span><span class="o">+</span><span class="s1">&#39;/&#39;</span><span class="o">+</span><span class="n">g</span><span class="p">)</span>
</pre></div>


<p>This checks where should the folder of certain audio go based in the config file and moves it.</p>
<p>The current directory <strong>structure</strong> looks something like:</p>
<div class="highlight"><pre><span></span>└───NAR_dataset
    ├───Kitchen
    ├───Nonverbal
    ├───Speech
    └───Office
</pre></div>


<h4>2.b.ii. Renaming Wav Files</h4>
<p>Great Work! We now have moved all our subfolders under the specified class labels.
We are going to move and rename all our <code>wav files</code> so that they look something like:</p>
<div class="highlight"><pre><span></span>ClassLabel_subtype_filename.wav
</pre></div>


<p>Example:</p>
<div class="highlight"><pre><span></span>Kitchen_alarmfridge_alarmfridge1.wav
</pre></div>


<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">move_files</span><span class="p">():</span>
    <span class="n">x</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
    <span class="k">print</span> <span class="s1">&#39;The folder has {} subfolders&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">folder</span> <span class="ow">in</span> <span class="n">x</span><span class="p">:</span>
        <span class="n">new_path</span><span class="o">=</span><span class="n">path</span><span class="o">+</span><span class="s1">&#39;/&#39;</span><span class="o">+</span><span class="n">folder</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">new_path</span><span class="p">):</span>
            <span class="n">y</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">new_path</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">y</span> <span class="o">==</span> <span class="p">[]:</span>
                <span class="k">print</span> <span class="s1">&#39;Empty subfolder:&#39;</span><span class="p">,</span><span class="n">folder</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">file_</span> <span class="ow">in</span> <span class="n">y</span><span class="p">:</span>
                    <span class="n">os</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">new_path</span><span class="o">+</span><span class="s1">&#39;/&#39;</span><span class="o">+</span><span class="n">file_</span><span class="p">,</span><span class="n">path</span><span class="o">+</span><span class="s1">&#39;/&#39;</span><span class="o">+</span><span class="n">folder</span><span class="o">+</span><span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="n">file_</span><span class="p">)</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">new_path</span><span class="p">):</span>
                        <span class="n">os</span><span class="o">.</span><span class="n">rmdir</span><span class="p">(</span><span class="n">new_path</span><span class="p">)</span>
</pre></div>


<p>The function checks for non-empty subfolders and moves it. It then removes the original folder.
We have to run the function two times in order to get to the root directory level.</p>
<div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">path</span><span class="o">+</span><span class="s1">&#39;/*&#39;</span><span class="p">):</span>
    <span class="n">x</span><span class="o">=</span><span class="n">f</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">4</span><span class="p">:]</span><span class="o">!=</span><span class="s1">&#39;.wav&#39;</span><span class="p">:</span>
        <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">path</span><span class="o">+</span><span class="s1">&#39;//&#39;</span><span class="o">+</span><span class="n">x</span><span class="p">)</span>
</pre></div>


<p>This deletes the DS_Store files which are not required.</p>
<h4>2.b.iii. Generating the metafile</h4>
<div class="highlight"><pre><span></span>str1=&#39;&#39;
arr1=[]
for f in glob.glob(path+&#39;/*&#39;):
    x=f.split(&#39;\\&#39;)[1]
    res = x.translate(None, digits).split(&#39;.&#39;)[0].split(&#39;_&#39;)[0]
    arr1.append(res)
    str1+=&#39;audio/&#39;+x+&#39;\t&#39;+res+&#39;\n&#39;

file1 = open(&quot;meta.txt&quot;,&quot;w&quot;) 
file1.write(str1) 
file1.close()
</pre></div>


<p>This fetches all the files and puts them under the <code>meta.txt</code> such that each file corresponds to their class labels.</p>
<h2>3. Lets Code</h2>
<h3>3.a. Feature Extraction</h3>
<p>In case of Audio, we flatten the data and pass it to the layers. We need to encapsulate the statistics of sound and make our model learn faster. IN our case we are using various features such as :
 * <strong>MEL filterbanks</strong> : Create a Filterbank matrix to combine FFT bins into Mel-frequency bins. </p>
<ul>
<li>
<p><strong>CQT(Constant Q Transform)</strong> : THe Constant-Q-Transform (CQT) is a time-frequency representation where the frequency bins are geometrically spaced and the so called Q-factors (ratios of the center frequencies to bandwidths) of all bins are equal.The CQT essentially a wavelet transform, which means that the frequency resolution is better for low frequencies and the time resolution is better for high frequencies.[4]</p>
</li>
<li>
<p><strong>LOG-MEL(Logarithm - mel)</strong> : We take logarithm of the Filterbank matrix.</p>
</li>
<li>
<p><strong>LOG-MFCC(Logarithm - MFCC )</strong> : A widely used metric for describing timbral characteristics based on the Mel scale. Implemented according to Huang [1], Davis [2], Grierson [3] and the librosa library.</p>
</li>
</ul>
<h4>3.a.i. CQT</h4>
<div class="highlight"><pre><span></span><span class="c1">#Define all features to be extracted</span>
<span class="kn">import</span> <span class="nn">config</span> <span class="kn">as</span> <span class="nn">cfg</span>
<span class="k">def</span> <span class="nf">cqt_lib</span><span class="p">(</span><span class="n">wav_fd</span><span class="p">,</span><span class="n">fe_fd</span><span class="p">):</span>
    <span class="n">names</span> <span class="o">=</span> <span class="p">[</span> <span class="n">na</span> <span class="k">for</span> <span class="n">na</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">wav_fd</span><span class="p">)</span> <span class="k">if</span> <span class="n">na</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.wav&#39;</span><span class="p">)</span> <span class="p">]</span>
    <span class="n">names</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">names</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">na</span> <span class="ow">in</span> <span class="n">names</span><span class="p">:</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">wav_fd</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="n">na</span>
        <span class="n">wav</span><span class="p">,</span> <span class="n">sr</span><span class="o">=</span><span class="n">librosa</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">path</span><span class="p">,</span><span class="n">sr</span><span class="o">=</span><span class="mi">44100</span><span class="p">)</span>
        <span class="n">cqt</span><span class="o">=</span><span class="n">librosa</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">cqt</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">wav</span><span class="p">)</span>
        <span class="n">out_path</span> <span class="o">=</span> <span class="n">fe_fd</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="n">na</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;.f&#39;</span>
        <span class="n">cPickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span> <span class="n">cqt</span><span class="p">,</span> <span class="nb">open</span><span class="p">(</span><span class="n">out_path</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">),</span> <span class="n">protocol</span><span class="o">=</span><span class="n">cPickle</span><span class="o">.</span><span class="n">HIGHEST_PROTOCOL</span> <span class="p">)</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
     <span class="n">cfg</span><span class="o">.</span><span class="n">CreateFolder</span><span class="p">(</span><span class="s1">&#39;Fe&#39;</span><span class="p">)</span>
     <span class="n">cfg</span><span class="o">.</span><span class="n">CreateFolder</span><span class="p">(</span><span class="s1">&#39;Fe/cqt&#39;</span><span class="p">)</span>
     <span class="n">cqt_lib</span><span class="p">(</span><span class="n">cfg</span><span class="o">.</span><span class="n">wav_fd</span><span class="p">,</span><span class="n">cfg</span><span class="o">.</span><span class="n">fe_cqt_fd</span><span class="p">)</span>
</pre></div>


<h3>3.b. Simple DNN Model</h3>
<p>We are going to make a simple dnn model and pass on certain parameters which are required for the model.</p>
<div class="highlight"><pre><span></span><span class="c1">#Our files</span>
<span class="kn">import</span> <span class="nn">config</span> <span class="kn">as</span> <span class="nn">cfg</span>
<span class="kn">import</span> <span class="nn">features</span> <span class="kn">as</span> <span class="nn">F</span>
<span class="kn">import</span> <span class="nn">apnahat</span> <span class="kn">as</span> <span class="nn">H</span>

<span class="c1">#Python modules</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">csv</span>
<span class="kn">import</span> <span class="nn">cPickle</span>

<span class="c1">#Data managing modules</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">sklearn.cross_validation</span> <span class="kn">import</span> <span class="n">KFold</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">classification_report</span><span class="p">,</span> <span class="n">accuracy_score</span>

<span class="c1">#Deep Learning Modules</span>
<span class="kn">from</span> <span class="nn">keras.models</span> <span class="kn">import</span> <span class="n">Sequential</span>
<span class="kn">from</span> <span class="nn">keras.layers</span> <span class="kn">import</span> <span class="n">Dense</span><span class="p">,</span><span class="n">Dropout</span>
<span class="kn">from</span> <span class="nn">keras.layers.advanced_activations</span> <span class="kn">import</span> <span class="n">LeakyReLU</span>
<span class="kn">from</span> <span class="nn">keras.utils</span> <span class="kn">import</span> <span class="n">to_categorical</span>
</pre></div>


<p>Whenever we work with machine learning algorithms that use a stochastic process (e.g. random numbers), it is a good idea to set the random number seed.</p>
<p>This is so that you can run the same code again and again and get the same result. 
You can initialize the random number generator with any seed you like      </p>
<div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">1234</span><span class="p">)</span>
</pre></div>


<p>Each feature has a separate dimension, we are using cqt which returns features with dimension as 80.</p>
<p>We set the parameters initially based on the feature.</p>
<div class="highlight"><pre><span></span><span class="n">dimension1</span> <span class="o">=</span> <span class="mi">80</span>
<span class="n">dimension2</span> <span class="o">=</span> <span class="n">dimension1</span><span class="o">*</span><span class="mi">10</span>
<span class="n">agg_num</span><span class="o">=</span><span class="mi">10</span>
<span class="n">hop</span><span class="o">=</span><span class="mi">10</span>
<span class="n">feature_text</span><span class="o">=</span><span class="s2">&quot;cqt&quot;</span>
<span class="n">fe_fd</span> <span class="o">=</span> <span class="n">cfg</span><span class="o">.</span><span class="n">fe_cqt_fd</span>
<span class="k">print</span> <span class="s2">&quot;Feature&quot;</span><span class="p">,</span><span class="n">feature_text</span>
</pre></div>


<p>We define all our <code>hyperparameters</code>. Configuring neural networks is difficult because there is no good theory on how to do it.</p>
<p>We must be systematic and explore different configurations and  understand what is going on for a given predictive modeling problem.</p>
<div class="highlight"><pre><span></span><span class="n">input_neurons</span><span class="o">=</span><span class="mi">200</span>
<span class="n">dropout</span><span class="o">=</span><span class="mf">0.1</span>
<span class="n">act1</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span>
<span class="n">act2</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span>
<span class="n">act3</span><span class="o">=</span><span class="s1">&#39;sigmoid&#39;</span>
<span class="n">act4</span><span class="o">=</span><span class="s1">&#39;softmax&#39;</span>
<span class="n">epochs</span><span class="o">=</span><span class="mi">20</span>
<span class="n">batchsize</span><span class="o">=</span><span class="mi">20</span>
<span class="n">num_classes</span><span class="o">=</span><span class="mi">4</span>
</pre></div>


<p>We now make a separate function for using the <code>meta</code> file as a base for calling all the features of the <strong>audio</strong> files. This function returns a 3d array as it comes in handy when handling Convolution Neural Networks. </p>
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">GetAllData</span><span class="p">(</span><span class="n">fe_fd</span><span class="p">,</span> <span class="n">csv_file</span><span class="p">,</span> <span class="n">agg_num</span><span class="p">,</span> <span class="n">hop</span><span class="p">):</span>
    <span class="c1"># read csv</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span> <span class="n">csv_file</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">reader</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">reader</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="n">lis</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">reader</span><span class="p">)</span>

    <span class="c1"># init list</span>
    <span class="n">X3d_all</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">y_all</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">i</span><span class="o">=</span><span class="mi">0</span>
    <span class="k">for</span> <span class="n">li</span> <span class="ow">in</span> <span class="n">lis</span><span class="p">:</span>
        <span class="c1"># load data</span>
        <span class="p">[</span><span class="n">na</span><span class="p">,</span> <span class="n">lb</span><span class="p">]</span> <span class="o">=</span> <span class="n">li</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">na</span> <span class="o">=</span> <span class="n">na</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">fe_fd</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="n">na</span> <span class="o">+</span> <span class="s1">&#39;.f&#39;</span>
        <span class="c1">#i+=1</span>
        <span class="c1">#print i</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">X</span> <span class="o">=</span> <span class="n">cPickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span> <span class="nb">open</span><span class="p">(</span> <span class="n">path</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span> <span class="p">)</span> <span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">print</span> <span class="s1">&#39;Error while parsing&#39;</span><span class="p">,</span><span class="n">path</span>
            <span class="k">continue</span>
        <span class="c1"># reshape data to (n_block, n_time, n_freq)</span>
        <span class="n">i</span><span class="o">+=</span><span class="mi">1</span>
        <span class="k">if</span> <span class="n">i</span><span class="o">%</span><span class="mi">100</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
            <span class="k">print</span> <span class="s2">&quot;Files Loaded&quot;</span><span class="p">,</span><span class="n">i</span>
        <span class="n">X3d</span> <span class="o">=</span> <span class="n">H</span><span class="o">.</span><span class="n">mat_2d_to_3d</span><span class="p">(</span> <span class="n">X</span><span class="p">,</span> <span class="n">agg_num</span><span class="p">,</span> <span class="n">hop</span> <span class="p">)</span>
        <span class="n">X3d_all</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">X3d</span> <span class="p">)</span>
        <span class="n">y_all</span> <span class="o">+=</span> <span class="p">[</span> <span class="n">cfg</span><span class="o">.</span><span class="n">lb_to_id</span><span class="p">[</span><span class="n">lb</span><span class="p">]</span> <span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span> <span class="n">X3d</span> <span class="p">)</span>

    <span class="k">print</span> <span class="s1">&#39;All files loaded successfully&#39;</span>
    <span class="c1"># concatenate list to array</span>
    <span class="n">X3d_all</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span> <span class="n">X3d_all</span> <span class="p">)</span>
    <span class="n">y_all</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span> <span class="n">y_all</span> <span class="p">)</span>

    <span class="k">return</span> <span class="n">X3d_all</span><span class="p">,</span> <span class="n">y_all</span>
</pre></div>


<p>We call the function to return a 3d array of train X and  1d array of train Y. We now reshape our 3d array into 1d.</p>
<div class="highlight"><pre><span></span><span class="n">tr_X</span><span class="p">,</span> <span class="n">tr_y</span> <span class="o">=</span> <span class="n">GetAllData</span><span class="p">(</span> <span class="n">fe_fd</span><span class="p">,</span> <span class="n">cfg</span><span class="o">.</span><span class="n">meta_csv</span><span class="p">,</span> <span class="n">agg_num</span><span class="p">,</span> <span class="n">hop</span> <span class="p">)</span>
<span class="n">tr_X</span><span class="o">=</span><span class="n">tr_X</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">tr_X</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">tr_X</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">tr_X</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
</pre></div>


<p><strong>Altering the feature arrays</strong></p>
<p>We are using a single function from the <a href="https://github.com/qiuqiangkong/Hat">hat</a> module. We are going to make a separate model for that and call it <strong><em>apnahat.py</em></strong>. The function takes a 2d array as input and returns a 3d array. We shall be using this to pass into our model.</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="k">def</span> <span class="nf">mat_2d_to_3d</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">agg_num</span><span class="p">,</span> <span class="n">hop</span><span class="p">):</span>
    <span class="c1"># pad to at least one block</span>
    <span class="n">len_X</span><span class="p">,</span> <span class="n">n_in</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">shape</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">len_X</span> <span class="o">&lt;</span> <span class="n">agg_num</span><span class="p">):</span>
        <span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">X</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">agg_num</span><span class="o">-</span><span class="n">len_X</span><span class="p">,</span> <span class="n">n_in</span><span class="p">))))</span>
    <span class="c1"># agg 2d to 3d</span>
    <span class="n">len_X</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
    <span class="n">i1</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">X3d</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">while</span> <span class="p">(</span><span class="n">i1</span><span class="o">+</span><span class="n">agg_num</span> <span class="o">&lt;=</span> <span class="n">len_X</span><span class="p">):</span>
        <span class="n">X3d</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="n">i1</span><span class="p">:</span><span class="n">i1</span><span class="o">+</span><span class="n">agg_num</span><span class="p">])</span>
        <span class="n">i1</span> <span class="o">+=</span> <span class="n">hop</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">X3d</span><span class="p">)</span>
</pre></div>


<h4>3.b.ii. The DNN Model</h4>
<p>We are now going to make a function for our model which returns a compiled model.</p>
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">prepare_model</span><span class="p">():</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">Sequential</span><span class="p">()</span>
    <span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">Dense</span><span class="p">(</span><span class="n">input_neurons</span><span class="p">,</span> <span class="n">input_dim</span> <span class="o">=</span> <span class="n">dimension2</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="n">act1</span><span class="p">))</span>
    <span class="n">lr</span><span class="o">=</span><span class="n">LeakyReLU</span><span class="p">(</span><span class="n">alpha</span><span class="o">=.</span><span class="mo">001</span><span class="p">)</span>
    <span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">lr</span><span class="p">)</span>
    <span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">Dropout</span><span class="p">(</span><span class="n">dropout</span><span class="p">))</span>
    <span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">Dense</span><span class="p">(</span><span class="n">input_neurons</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="n">act2</span><span class="p">))</span>
    <span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">Dropout</span><span class="p">(</span><span class="n">dropout</span><span class="p">))</span>
    <span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">Dense</span><span class="p">(</span><span class="n">input_neurons</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="n">act3</span><span class="p">))</span>
    <span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">Dropout</span><span class="p">(</span><span class="n">dropout</span><span class="p">))</span>
    <span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">Dense</span><span class="p">(</span><span class="n">num_classes</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="n">act4</span><span class="p">))</span>
    <span class="n">model</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">loss</span><span class="o">=</span><span class="s1">&#39;categorical_crossentropy&#39;</span><span class="p">,</span>
                  <span class="n">optimizer</span><span class="o">=</span><span class="s1">&#39;adam&#39;</span><span class="p">,</span>
                  <span class="n">metrics</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;accuracy&#39;</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">model</span>
</pre></div>


<p>We are going to implement cross-validation. In our case, we are going to do a 10-fold cross-validation.</p>
<div class="highlight"><pre><span></span><span class="n">kf</span> <span class="o">=</span> <span class="n">KFold</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">tr_X</span><span class="p">),</span><span class="mi">2</span><span class="p">,</span><span class="n">shuffle</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span><span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
<span class="n">results</span><span class="o">=</span><span class="p">[]</span>    
<span class="k">for</span> <span class="n">train_indices</span><span class="p">,</span> <span class="n">test_indices</span> <span class="ow">in</span> <span class="n">kf</span><span class="p">:</span>
    <span class="n">train_x</span> <span class="o">=</span> <span class="p">[</span><span class="n">tr_X</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="n">train_indices</span><span class="p">]</span>
    <span class="n">train_y</span> <span class="o">=</span> <span class="p">[</span><span class="n">tr_y</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="n">train_indices</span><span class="p">]</span>
    <span class="n">test_x</span>  <span class="o">=</span> <span class="p">[</span><span class="n">tr_X</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="n">test_indices</span><span class="p">]</span>
    <span class="n">test_y</span>  <span class="o">=</span> <span class="p">[</span><span class="n">tr_y</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="n">test_indices</span><span class="p">]</span>
    <span class="n">train_y</span> <span class="o">=</span> <span class="n">to_categorical</span><span class="p">(</span><span class="n">train_y</span><span class="p">,</span><span class="n">num_classes</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
    <span class="n">test_y</span> <span class="o">=</span> <span class="n">to_categorical</span><span class="p">(</span><span class="n">test_y</span><span class="p">,</span><span class="n">num_classes</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span> 

    <span class="n">train_x</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">train_x</span><span class="p">)</span>
    <span class="n">train_y</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">train_y</span><span class="p">)</span>
    <span class="n">test_x</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">test_x</span><span class="p">)</span>
    <span class="n">test_y</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">test_y</span><span class="p">)</span>
    <span class="k">print</span> <span class="s2">&quot;All arrays loaded&quot;</span>

    <span class="c1">#get compiled model</span>
    <span class="n">lrmodel</span><span class="o">=</span><span class="n">prepare_model</span><span class="p">()</span>
    <span class="c1">#see the model</span>
    <span class="k">print</span> <span class="n">lrmodel</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>
    <span class="c1">#fit the model</span>
    <span class="n">lrmodel</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">train_x</span><span class="p">,</span><span class="n">train_y</span><span class="p">,</span><span class="n">batch_size</span><span class="o">=</span><span class="n">batchsize</span><span class="p">,</span><span class="n">epochs</span><span class="o">=</span><span class="n">epochs</span><span class="p">,</span><span class="n">verbose</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="c1">#make prediction</span>
    <span class="n">pred</span><span class="o">=</span><span class="n">lrmodel</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">test_x</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="mi">32</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="n">pred</span> <span class="o">=</span> <span class="p">[</span><span class="n">ii</span><span class="o">.</span><span class="n">argmax</span><span class="p">()</span><span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="n">pred</span><span class="p">]</span>
    <span class="n">test_y</span> <span class="o">=</span> <span class="p">[</span><span class="n">ii</span><span class="o">.</span><span class="n">argmax</span><span class="p">()</span><span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="n">test_y</span><span class="p">]</span>

    <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">accuracy_score</span><span class="p">(</span><span class="n">pred</span><span class="p">,</span><span class="n">test_y</span><span class="p">))</span>
    <span class="k">print</span> <span class="n">accuracy_score</span><span class="p">(</span><span class="n">pred</span><span class="p">,</span><span class="n">test_y</span><span class="p">)</span>
    <span class="n">jj</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">test_y</span><span class="p">)))</span>
    <span class="k">print</span> <span class="s2">&quot;Unique in test_y&quot;</span><span class="p">,</span><span class="n">jj</span>
<span class="k">print</span> <span class="s2">&quot;Results: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">results</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span> <span class="p">)</span>
<span class="k">print</span> <span class="n">classification_report</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">test_y</span><span class="p">),</span><span class="n">pred</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>


<h2>4. References</h2>
<p>[1] X. Huang, A. Acero, and H.-W. Hon, Spoken Language Processing: A Guide to Theory, Algorithm, and System Development. Upper Saddle River, NJ, USA: Prentice Hall PTR, 1st ed., 2001.</p>
<p>[2] S. Davis and P. Mermelstein, “Comparison of parametric representations for monosyllabic word recognition in continuously spoken sentences,” Acoustics, Speech and Signal Processing, IEEE Transactions on, vol. 28, pp. 357–366, Aug 1980.</p>
<p>[3] M. Grierson, “Maximilian: A cross platform c++ audio synthesis library for artists learning to program.,” in Proceedings of International Computer Music Conference, 2010.</p>
<p>[4] lidy2016cqt,"CQT-based convolutional neural networks for audio scene classification and domestic audio tagging," in IEEE AASP Challenge on Detection and Classification of Acoustic Scenes and Events (DCASE 2016), Budapest, Hungary, Tech. Rep, 2016.
}</p>
    </article>

    <hr>

            </div>
        </div>
    </div>

    <hr>

    <!-- Footer -->
    <footer>
        <div class="container">
            <div class="row">
                <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                    <ul class="list-inline text-center">
                        <li>
                            <a href="">
                                <span class="fa-stack fa-lg">
                                    <i class="fa fa-circle fa-stack-2x"></i>
                                    <i class="fa fa-twitter fa-stack-1x fa-inverse"></i>
                                </span>
                            </a>
                        </li>
                        <li>
                            <a href="">
                                <span class="fa-stack fa-lg">
                                    <i class="fa fa-circle fa-stack-2x"></i>
                                    <i class="fa fa-facebook fa-stack-1x fa-inverse"></i>
                                </span>
                            </a>
                        </li>
                        <li>
                            <a href="">
                                <span class="fa-stack fa-lg">
                                    <i class="fa fa-circle fa-stack-2x"></i>
                                    <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                                </span>
                            </a>
                        </li>
                    </ul>
                    <p class="copyright text-muted">Blog powered by <a href="http://getpelican.com">Pelican</a>,
                which takes great advantage of <a href="http://python.org">Python</a>.</p>
                </div>
            </div>
        </div>
    </footer>

    <!-- jQuery -->
    <script src="/theme/js/jquery.js"></script>

    <!-- Bootstrap Core JavaScript -->
    <script src="/theme/js/bootstrap.min.js"></script>

    <!-- Custom Theme JavaScript -->
    <script src="/theme/js/clean-blog.min.js"></script>

</body>

</html>